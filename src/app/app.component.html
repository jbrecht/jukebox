<div class="app">
  <header class="header">
    <div class="logo-container">
      <h1><img src="assets/tasty-2.svg" alt="Tasty Logo" class="logo"><span>Jukebox</span></h1>
    </div>
  </header>
  
  <!-- Enhanced Custom Music Player -->
  <section class="player-section">
    <div class="player-container">
      @if (currentlyPlaying) {
        <div class="now-playing-info">
          <div class="now-playing-text">üéµ Now Playing</div>
          <div class="song-title">{{ formatFileName(currentlyPlaying.name) }}</div>
          <div class="time-info">
            <span class="current-time">{{ formatTime(currentTime) }}</span>
            <span class="separator"> / </span>
            <span class="total-time">{{ formatTime(duration) }}</span>
          </div>
        </div>
        
        <!-- Custom Progress Bar with Animation -->
        <div class="progress-container" (click)="seek($event)">
          <div class="progress-track">
            <div class="progress-fill" [style.width.%]="progress">
              <div class="progress-thumb" [class.playing]="isPlaying"></div>
            </div>
          </div>
          <div class="progress-glow" [style.width.%]="progress"></div>
        </div>
        
        <!-- Controls and Visualizer Row -->
        <div class="controls-row">
          <div class="audio-controls">
            <button class="control-btn" (click)="togglePlayPause()" [title]="isPlaying ? 'Pause' : 'Play'">
              <div class="btn-icon" [class.playing]="isPlaying">
                @if (isPlaying) {
                  <div class="pause-icon"></div>
                } @else {
                  <div class="play-icon"></div>
                }
              </div>
            </button>
            <a [href]="currentlyPlaying.url" [download]="currentlyPlaying.name" 
               class="control-btn download-btn" title="Download">
              <div class="btn-icon">üíæ</div>
            </a>
          </div>
          
          <!-- Compact Visualizer -->
          <div class="visualizer-container">
            <div class="visualizer-bars" [class.active]="isPlaying">
              <div class="bar" style="--delay: 0s; --height: 30%"></div>
              <div class="bar" style="--delay: 0.1s; --height: 70%"></div>
              <div class="bar" style="--delay: 0.2s; --height: 50%"></div>
              <div class="bar" style="--delay: 0.3s; --height: 90%"></div>
              <div class="bar" style="--delay: 0.4s; --height: 40%"></div>
              <div class="bar" style="--delay: 0.5s; --height: 80%"></div>
              <div class="bar" style="--delay: 0.6s; --height: 60%"></div>
              <div class="bar" style="--delay: 0.7s; --height: 35%"></div>
            </div>
          </div>
        </div>

        <!-- Hidden HTML Audio Element -->
        <audio #audioPlayer
               [src]="currentlyPlaying.url"
               (timeupdate)="onTimeUpdate()"
               (loadedmetadata)="onLoadedMetadata()"
               (play)="onPlay()"
               (pause)="onPause()"
               (ended)="onEnded()"
               preload="metadata"
               style="display: none;">
        </audio>
      } @else {
        <div class="no-music">
          <div class="select-music-text">Pick a song below</div>
          <div class="wave-placeholder">
            <div class="placeholder-bars">
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
              <div class="bar"></div>
            </div>
          </div>
        </div>
      }
    </div>
  </section>

  <main class="main-content">
    <!-- Left side: Playlists -->
    <aside class="sidebar-left">
      <div class="section-header">
        <h2><img src="/assets/crate.png" alt="Crate" class="section-icon"> Playlists</h2>
      </div>
      <div class="folder-list">
        @for (folder of folders; track folder.prefix) {
          <div class="folder-card" 
               [class.selected]="selectedFolder?.prefix === folder.prefix"
               (click)="selectFolder(folder)">
            <div class="folder-name">{{ formatFolderName(folder.name) }}</div>
          </div>
        }
      </div>
    </aside>
    
    <!-- Right side: Files -->
    <section class="content-area">
      @if (selectedFolder) {
        <div class="section-header">
          <h2>üéµ {{ formatFolderName(selectedFolder.name) }} Tracks</h2>
          <div class="track-count">{{ files.length }} songs</div>
        </div>
        <div class="file-grid">
          @for (file of files; track file.key) {
            <div class="track-card" 
                 [class.playing]="currentlyPlaying?.key === file.key">
              <div class="track-info">
                <div class="track-icon" [class.playing]="currentlyPlaying?.key === file.key">üéµ</div>
                <div class="track-details">
                  <div class="track-name" (click)="playFile(file)">{{ formatFileName(file.name) }}</div>
                  <div class="track-size">{{ s3Service.formatFileSize(file.size) }}</div>
                </div>
              </div>
              <div class="track-actions">
                <button class="action-btn play-btn" (click)="playFile(file)" 
                        [title]="'Play ' + file.name">
                  @if (currentlyPlaying?.key === file.key) {
                    üîä
                  } @else {
                    ‚ñ∂Ô∏è
                  }
                </button>
                <a [href]="file.url" [download]="file.name" 
                   class="action-btn download-btn" 
                   [title]="'Download ' + file.name">
                  üíæ
                </a>
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="welcome-area">
          <div class="welcome-icon">üé™</div>
          <h2>Welcome to the Big Top!</h2>
          <p>üëà Choose a folder to set your lineup!</p>
        </div>
      }
    </section>
  </main>
</div>